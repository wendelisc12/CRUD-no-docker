"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
function middleware() {
    return (req, res, next) => {
        res.marko = res.marko || renderMarkoTemplate;
        next();
    };
}
exports.default = middleware;
function renderMarkoTemplate(template, input) {
    const $global = { ...this.app.locals, ...this.locals };
    if (input) {
        if (input.$global) {
            Object.assign($global, input.$global);
        }
        input.$global = $global;
    }
    this.set("Content-Type", "text/html; charset=utf-8");
    template
        .render(input || { $global }, this)
        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
        .on("error", this.req.next);
}
//# sourceMappingURL=index.js.map